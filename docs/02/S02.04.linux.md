# Linux

![](./../../img/Tux.svg.png)

## Linux rules the world

- Parce que Docker est construit sur linux
- Les 2 tiers ou plus des serveurs web sont du Linux
- La majorit√© des images docker sont construites sur une image de base linux

Donc Linux c'est

- internet
- les serveurs d'entreprise
- chatGPT et toute l'IA et le machine learning et la science et Tesla, et le spatial et ...
- les mobiles (android est du linux)
- la science : NASA, CERN, ESA,
- m√™me [Tesla](https://rechargd.com/tesla-operating-system/) tourne sur une version propre de Linux

La liste est longue, tr√®s longue, ...

[When linux takes over the world](https://www.memedroid.com/memes/detail/4214365)

### Distributions Linux

Il y a plus de 600 distributions Linux actives avec Ubuntu qui compte pour 34%, suivi par Debian

- Ubuntu
- Debian
- Redhat
- Kali, Fedora, Suse, Alpine, Black Arch, ..., Mandrake

Une distribution linux est un OS (operating system) construit sur le noyau linux.

Une distribution Linux contient g√©n√©ralement :

- Le **Noyau linux** : Le c≈ìur du syst√®me d'exploitation, qui g√®re les ressources du syst√®me et permet la communication entre le mat√©riel et les logiciels.
- **GNU Tools** : outils et biblioth√®ques essentiels qui rendent le syst√®me utilisable.
- **Package Manager** : Un syst√®me qui aide √† installer, mettre √† jour et g√©rer les programmes (par exemple, `apt` ou `apt-get` pour Debian/Ubuntu, `dnf` pour Fedora, `pacman` pour Arch, `apk` pour Alpine).
- **Desktop Environment** (optionnel) : Une interface graphique comme GNOME, KDE ou Xfce. Certaines distributions n'offrent qu'une interface en ligne de commande.
- **Pre-installed Software** : Diverses applications, comme un √©diteur de texte (`vim`).

### Histoire

![](./../../img/what-are-clouds-made-of.png)

1991 [Linus Torvalds](https://fr.wikipedia.org/wiki/Linus_Torvalds), √©tudiant √† l'universit√© d'Helsinki, cr√©e le Noyau Linux. (Il a aussi cr√©e Git ensuite)

![](./../../img/Linus_Torvalds.jpeg)

Lire :

- Wikipedia Linux <https://fr.wikipedia.org/wiki/Linux>
- History of Linux <https://en.wikipedia.org/wiki/History_of_Linux> (pas de page en fran√ßais :( )
- Unix vs Linux quels sont les diff√©rences
<https://www.ionos.fr/digitalguide/serveur/know-how/unix-vs-linux/>

## Linux Basics

Nous avons donc acc√®s a un container Linux :)

Que pouvons nous faire et comment ca marche ?

Dans la suite de ce document on va :

- travailler sur les repertoires et fichier,
- naviguer dans le syst√®me de fichier,
- modifier, copier, cr√©er, supprimer les fichier et repertoires
- voir et √©diter les fichiers textes,
- modifier les permissions et acc√®s d'un fichier,
- installer des programmes avec le package manager,
- observer les process,

Let's go!

## 1. Commandes de base Linux

Commen√ßons par supprimer tous les containers que nous avons pu cr√©er jusqu'ici pour d√©marrer from scratch (de z√©ro).

Dans Docker Desktop > containers

- s√©lectionnez tout
- cliquez sur le bouton stop
- et supprimez tous les containers

La commande `docker ps -all` ne doit retourner aucune ligne.

Maintenant, rangez Docker Desktop dans un coin, sur un √©tag√®re, ....

Dans un terminal, cr√©ez et lancez un container ubuntu avec

```bash
docker run -it ubuntu /bin/bash
```

### Rappel: sortir et revenir dans le container

Si on sort du container avec `exit`, le container existe toujours mais ne tourne plus.

On peut le voir: `docker ps`  liste bien le container avec comme status **UP** .
Si le container √©tait stopp√©, `docker ps -all` donnerait un status : "Exited"

La commande `docker run -it ubuntu /bin/bash` va cr√©er un nouveau container. Ce n'est pas ce que l'on souhaite.
On souhaite se re-attacher au container existant.

On trouve l'ID du container avec `docker ps`. ici ```45f1bbf4d38d```

![](./../../img/docker-ps.png)

On se _reconnecte_ au container avec :

```bash
docker exec -it <container ID> /bin/bash
```

Note: On peut aussi d'abord red√©marrer le container puis s'y attacher

```bash
docker start <container ID>
docker attach <container ID>
```

Dans les 2 cas, on retrouve le prompt de la session Ubuntu.

```bash
root@45f1bbf4d38d:/#
```

### Hi√©rarchie du syst√®me de fichier Linux

la commande `ls -al` liste les fichiers et repertoires. Comme on est √† la racine du server, (`pwd` retourne `\`) `ls -al` affiche tous les r√©pertoires de base du syst√®me Linux.

L'architecture des r√©pertoires d'une repo linux est stable pour toute les distributions linux.

Je vous laisse lire la signification et le r√¥le de chaque r√©pertoire.

<https://en.wikipedia.org/wiki/Unix_filesystem#Conventional_directory_layout>

![hi√©rarchie filesystem unix](./../../img/standard-unix-filesystem-hierarchy-1.png)

## 2. File System Navigation

### user et super user

Notez que vous √™tes loggu√© comme `root`

```bash
root@45f1bbf4d38d:/#
```

Root est le super user. Il peut tout faire.

![Sudo make me a sandwich](./../../img/memes/xkcd-sandwich.png)
<https://xkcd.com/149/>

Il peut m√™me supprimer tout avec la fameuse commande

```bash
rm -rf /
```

**Attention √† ne jamais executer cette commande!**

Normalement, on ne travaille jamais sur le compte `root`. Jamais.

Mais comme notre container Ubuntu n'a pas pour vocation d'avoir des utilisateurs externes, nous allons exceptionnellement travailler en tant que root.

Un utilisateur `ubuntu` a quand m√™me √©t√© cr√©√©e.

On peut se connecter avec le user ubuntu avec

```bash
su - ubuntu
```

Le prompt change

```bash
ubuntu@45f1bbf4d38d:~$
```

Le user est `ubuntu`. Notez aussi que le `#` final est devenu `$`. Le signe `#` indique que vous travaillez en tant que super user (zone de danger).

Enfin la commande `whoami` (lit. qui suis je?) retourne le nom de l'utilisateur qui est connect√©

![](./../../img/whoami.png)

Pour revenir √† `root`:

```bash
exit
```

### Se d√©placer dans les repertoires

Pour se d√©placer dans les repertoires on utilise les commandes

- `pwd`: Path to Working Directory: le repertoire courant
- `ls`: liste les fichiers. Utile avec les flags -al et -alh. un alias est souvent disponible : `ll`
- `cd`: change directory

Notes: ces commandes ont √©t√© import√© dans powershell.

Quelques commandes pour les fichiers et r√©pertoires:

- `mkdir <directory>` : cr√©er un r√©pertoire
- `touch <file>`:  cr√©e un fichier vide
- `cp (-r -f) <file> <directory>`: Pour copier fichiers et r√©pertoires
- `mv <file> <directory>`: d√©placer et **renommer** fichiers et r√©pertoires
- `rm, rmdir`: supprimer fichiers et r√©pertoires

### noms de fichiers

 Il y a des r√®gles √† respecter dans le nomage des fichiers et r√©pertoires

- Case sensitive: `Truc.txt` et `truc.txt` sont deux fichiers diff√©rents
- n'utiliser que: (a-z, A-Z), numbers (0-9), periods (.), underscores (_), and hyphens (-). le premier character ne doit pas √™tre un '-'
- PAS d'espace dans le noms de fichiers. Vraiment! C'est juste pas cool!
- Ne pas utiliser les caract√®res sp√©ciaux comme: `*, &, %, $, #, @, !,`
- Les fichier cach√©s d√©butent par un '.'

Exemples √† √©viter:

```bash
My Project Report (Final Version).pdf  # espaces
2023_$ales_Data.csv  # caractere special
-start-with-hyphen.txt  # commence par un -
```

Allez dans le r√©pertoire `/home/`, r√©pertoire des comptes utilisateurs et faites `ls -al` :

```bash
total 20
drwxr-xr-x 1 root   root   4096 Aug 27 16:06 .
drwxr-xr-x 1 root   root   4096 Sep 26 10:51 ..
drwxr-x--- 1 ubuntu ubuntu 4096 Sep 26 13:32 ubuntu
```

Le container ne contient qu'un utilisateur: `ubuntu`.

```bash
cd ubuntu
```

## 4. Fichiers d'initialization de la session

Dans le r√©pertoire `/home/ubuntu` on a les fichiers suivants (`ls -al`) :`.bash_logout  .bashrc  .profile`

![](./../../img/ubuntu-home-ls.png)

avec `cat`, on peut afficher le contenu de ces fichiers directement dans le terminal.

ex√©cutez l'un apr√®s l'autre:

- `cat .bashrc`
- `cat .bash_logout`
- `cat .profile`

Voici les premi√®res lignes de chaque fichier

- `# ~/.bashrc: executed by bash(1) for non-login shells. Every time you open a new terminal session (without logging in, such as launching a terminal from your desktop)`

- `# ~/.bash_logout: executed by bash(1) when login shell exits`

- `# ~/.profile: executed by the command interpreter for login shells`

Quand on acc√®de √† une nouvelle session dans le terminal, avec ou sans login (SSH. console login, virtual console), le shell / bash lit le fichier `.profile` ou `.bashrc`.

> c'est la m√™me chose sur le mac. il y a un fichier .zshrc qui est lu a chaque nouvelle session dans le terminal. Sur Windows, il y a un √©quivalent situ√©: `~\Documents\PowerShell\Microsoft.PowerShell_profile.ps1`.

### Afficher le contenu d'un fichier dans le terminal

Pour voir les N premieres ou N dernieres lignes d'un fichier on utilise

- `head -n N <nom du fchier>`
- `tail -n N <nom du fchier>`

on peut enchainer les commandes avec le symbole pipe '|'

```bash
head -n 200 fichier.txt | tail -n 10
```

Donne les 10 lignes 190 a 199 du fichier

C'est tr√®s utile pour afficher en continu un fichier de log au fur et a mesure des op√©rations:

```bash
tail -f  -n 100 <log file>
```

Cela affiche les 100 derni√®res lignes du fichier log en streaming / continu.

### √âditer un fichier avec vim

Pour modifier, √©diter un fichier on utilise `vim` ou `nano`.

`vim` n'est pas inclut par d√©faut dans ubuntu. On l'installe avec `apt-get`

```bash
apt-get install vim
```

Note pour trouver le nom d'un package on utilise `apt-cache search <nom du package>`

On √©dite un fichier avec

```bash
vim <nom du fichier>
```

Il y a 2 modes, le mode edition et le mode navigation.

- pour passer en mode edition: `i`
- pour passer en mode navigation: `esc`

pour sortir de vim

```bash
:wq
```

![exit vim](./../../img/memes/exit-vim.png)

Vim prend un peu de temps √† ma√Ætriser mais √ßa vaut le coup.

Je conseille les tutos suivants pour d√©marrer:

- freecodecamp: <https://www.freecodecamp.org/news/vim-beginners-guide/>
- en fran√ßais: <https://fr.linux-console.net/?p=9940>
- et interactif: <https://openvim.com/sandbox.html>

### Question

Dans le r√©pertoire ubuntu, on a la config du user `ubuntu` : `.bashrc`, `.profile` etc ...

Mais on s'est connect√© avec `root`.  O√π se trouve donc le fichier `.bashrc` de root ?

Bah! Dans le r√©pertoire  `/root` pardi!

```bash
cd /root
```

`ls -al` affiche les fichiers

```bash
root@45f1bbf4d38d:~# ls -al
total 32
drwx------ 1 root root 4096 Sep 26 13:32 .
drwxr-xr-x 1 root root 4096 Sep 26 10:51 ..
-rw------- 1 root root 1010 Sep 26 14:06 .bash_history
-rw-r--r-- 1 root root 3106 Apr 22 15:04 .bashrc
drwx------ 3 root root 4096 Sep 26 13:32 .config
-rw-r--r-- 1 root root  161 Apr 22 15:04 .profile
```

dont `.bash_history` qui contient l'historique des commandes.

### Grep

Autre commande super puissante : `grep`

```bash
grep [OPTION]... PATTERNS [FILE]
```

Par exemple trouver les alias (les raccourcis commandes) dans le fichier .bashrc

```bash
grep alias .bashrc
```

retourne les ligne qui contiennent le mot **alias**

Le format g√©n√©rale de `grep` est :

```bash
Usage: grep [OPTION]... PATTERNS [FILE]...
Search for PATTERNS in each FILE.
Example: grep -i 'hello world' menu.h main.c
```

Exercice:

- utilisez `cat` et `grep` pour retrouver une commande particuli√®re dans .bash_history.
- CTRL+R marche aussi

## 5. File Permissions and Ownership

Quand on liste les fichiers avec `ls -al`, on voit les permissions de fichier

```bash
-rw-r--r-- 1 ubuntu ubuntu  220 Mar 31 08:41 .bash_logout
```

Le premier caract√®re repr√©sente le type de fichier:

- `d` pour directory et `-` pour fichier

ensuite on distingue 3 blocks (owner, group, other) de 3 caract√®res

- `r` : pour read
- `w` : pour write
- `x` : pour executer

Si a la place du `r`, `w` ou `x`, on a un `-`: le fichier n'est ni lisible, ni modifiable, ni ex√©cutable pour le owner, le groupe ou tout le monde

 ‚õîÔ∏è‚õîÔ∏è‚õîÔ∏è Un fichier avec `-rwxrwxrwx` est lisible, modifiable et surtout executable par tous les utilisateurs. tr√®s dangereux. üß®üß®üß®

On voit aussi:

- `ubuntu ubuntu` : le owner et le group auquel le fichier appartient

### Exemple

par exemple, si on cr√©e un nouveau fichier avec  `touch fichier.txt`, ce fichier aura un niveau de permissions assez restrictif:

```bash
-rw-r--r-- 1 root   root      0 Sep 26 09:53 fichier.txt
```

Nous sommes loggu√© en tant que `root`, donc le owner et le group sont aussi `root root`

Connectons nous maintenant en tant que user `ubuntu` avec `su - ubuntu`.

Si on cr√©e un autre fichier `touch fichier2.txt`, on aura `ubuntu` comme owner de `fichier2.txt`

```bash
-rw-rw-r-- 1 ubuntu ubuntu     0 Sep 26 11:55 fichier2.txt
```

et les permissions sont moins restrictives.

Pour revenir √† la session root : `exit`

### chmod et chown

On change

- les permissions d'un fichier avec `chmod`. Voir <https://www.gnu.org/software/coreutils/chmod>
- le owner avec `chown`. Voir <https://www.gnu.org/software/coreutils/chown>

Restreindre le niveau de permissions au owner est souvent demand√© pour les clefs SSH ou les fichiers de mot de passe.

## 6. Package Management

Sur Debian et Ubuntu, installer un package, (programme, executable, ...) utilise le package manager `apt-get`.
Sur d'autres distributions linux, le nom du package manager peut √™tre diff√©rent.

L'installation d'une programme est toujours en 2 temps:

1. mettre a jour l'index du package manager pour qu'il ait connaissance de l'existence de la version la plus r√©cente du programme.

```bash
sudo apt-get update
```

2. puis installer le programme

```bash
sudo apt-get install  <nom du programme>
```

### Sudo or not Sudo

> `sudo` veut dire `super user do`.

`sudo` permet √† un utilisateur non root de devenir `root` le temps d'une ou plusieurs commandes dans une session.

Comme nous sommes `root`, nous n'avons pas besoin de `sudo`.
Donc en tant que root nous installons un programme avec:

```bash
apt-get update
apt-get install <nom du programme>
```

sans faire pr√©c√©der `apt-get` de `sudo`

### Installer `wget`

task: on veut r√©cup√©rer un fichier online.  Le programme le plus simple est `wget`.
On peut aussi utiliser `curl` qui est plus complet et complexe.

```bash
wget <url>
```

Un exemple, essayons de r√©cup√©rer un fichier csv sur le github

```bash
wget https://raw.githubusercontent.com/SkatAI/ynov-docker/refs/heads/master/data/WorldHits.csv
```

La commande ci-dessus donne : `wget unknown`

Il faut donc installer `wget`

d'abord toujours par mettre √† jour la liste des packages avec:

```bash
apt-get update
```

> Note:
`apt-get upate` n'installe rien. Pour mettre √† jour tous les programmes d√©j√† install√©, on fait ensuite  `apt-get upgrade`.

Ensuite on installe `wget` avec: `apt-get wget` et enfin on peut downloader le fichier

### A vous: afficher le contenu d'un fichier de type texte

Tout d'abord r√©cup√©rer le fichier csv avec wget

```bash
wget https://raw.githubusercontent.com/SkatAI/ynov-docker/refs/heads/master/data/WorldHits.csv
```

C'est un fichier de quelques centaines de tracks de Spotify.

En utilisant `cat`, `head` et `tail` ainsi que le pipe `|`, affichez :

- la premi√®re ligne du fichier
- les 10 derni√®res lignes du fichier
- lignes 180 √† 199 du fichier

- Avec `grep` trouvez tous les tracks de :
  - "Al Di Meola"
  - "Youssou N'Dour"

- Changez le `owner` de WorldHits.csv pour `ubuntu` avec `chown`
- changez les permissions de WorldHits.csv pour que le fichier soit writable par tous le monde: `-rw-rw-rw-`

Hint: regardez dans le manuel avec `man chown` et `man chown`

### Recap

Pour installer un executable (utilisateur non root)

```bash
sudo apt-get update
sudo apt-get install <program / package>
```

quand on est `root`, ne pas mettre `sudo`

Il ne faut üß®üß®üß® **JAMAIS TRAVAILLER EN TANT QUE ROOT** üß®üß®üß®

## 7. Process Management avec `top` et `ps`

Derni√®re chose

On souhaite voir les programmes qui tournent dans le container avec `top` et `ps`. Ces commandes permettent de troubleshooter les programmes qui ont crash√© ou qui sont trop consommateurs de resources.

- `top:` donne la liste des process en cours d'ex√©cution qui sont les plus intensifs ainsi que le **load average**

![](./../../img/ubuntu-top.png)

Le **load average** est √† surveiller pour voir si la VM est bien dimensionn√©e

- `ps` donne la liste des process en cours d'execution
- `ps -ef` et `ps aux` sont les deux commandes les plus utilis√©es.

![](./../../img/ubuntu-ps.png)

Pas grand chose ne tourne sur cette instance.

On peut combiner avec `grep` pour filtrer les process

Par exemple pour trouver les process li√©s a PostgreSQL, √† Nginx, ...:

- `ps aux | grep postgres`
- `ps aux | grep nginx`

La sortie de `ps` aux est envoy√©e directement √† `grep`

## prochain exercice

Vous allez installer un programme : `cowsay` et le faire fonctionner sur un container Ubuntu

## Pour finir

![Linux in space joke](./../../img/memes/linux-in-space.png)
