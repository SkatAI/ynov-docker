# Publiez un image sur Docker Hub

Le processus de publication d'une image locale sur un repository remote comme docker hub est en N étapes:

## Le tagging

Tagger une image avec ne copie pas l'image, mais l'associe juste à un (ou plusieurs) mots clefs.

- Il est possible de tagger une image avec plusieurs tags.
- La commande `docker images` liste tous les tags associés aux images. Vous voyez votre image listé plusieurs fois mais avec la même ID

La commande pour tagger une image est

```bash
docker tag <nom_image | nom_image:tag | image_id> <nouveau_nom:nouveau_tag | nom_image:nouveau_tag>
```

Tagger une image a 2 objectifs:

### Versioning

Tagger l'image permet tout d'abord d'associer une version à l'image : v01, latest, stable, ...

Par exemple pour une image avec l'id `abc123`, on peut l'associer a une version v1.0 avec :

```bash
docker tag abc123 myapp:v1.0
```

Cette commande crée l'alias `myapp:v1.0` pour l'image en question.
On peut ensuite la référencer non plus par son ID mais par son alias `myapp:v1.0`

### Remote Repositories

Tagger l'image permet aussi de lier l'image à un (ou plusieurs) repository remote pour pouvoir la publier (`push`) sur le repository

On peut ainsi tagger l'image `myapp` avec le username du repository

- un numéro de version v1.0 `docker tag myapp username/myapp:v1.0`
- avec le mot clé `latest` : `docker tag myapp username/myapp:latest`
- avec un autre registry (`otheruser`) : `docker tag myapp otheruser/myapp:stable`

note the whole tagging to publish on remote repos feels weird and incomplete. How does docker knows that the username:tag refers to a remote repo and is not just a local name?

## Le pushing

Une fois associé / taggée avec le remote repository, on publie (`push`, upload) l'image sur le repository avec la commande

```bash
docker push username/image:tag
```

## Publiez votre image my_nginx_alpine:v1

Vous allez publier maintenant votre image `my_nginx_alpine:v1` sur Docker Hub

### Créez votre compte et repo docker

- allez sur [https://docker.com](docker.com) et créez votre compte si vous n'en avez pas déjà un.
- notez votre `username`. Il vous servira à tagger l'image.
- Créez un repository sur <https://hub.docker.com>

![créer une repo sur Docker Hub](./../../img/docker-hub-create-repo.png)

![Créer une repo sur Docker Hub - step 2](./../../img/docker-hub-create-repo_2.png)

### tag, login, push

Taggez votre image locale avec votre `username` docker hub et le nom de votre repository

Par exemple:

- pour le username : `skatai`
- le compte : `ynov-docker`
- et le tag : `v1`

Je tagge l'image locale `my_nginx_alpine:v1` avec:

```bash
docker tag my_nginx_alpine:v1 skatai/ynov-docker:v1
```

Cette image apparait avec ses différents alias lorsque l'on fait `docker images`

Puis loguez-vous sur docker:

```bash
docker login
```

Enfin publiez l'image sur Docker Hub avec `docker push`

```bash
docker push skatai/ynov-docker:v1
```

## En quoi consiste le push d'une image ?

La commande `docker push` n'envoi pas le fichier executable de l'image.

Docker envoie les **layers** de l’image à Docker Hub.

Une image est composée de plusieurs layers (couches) chacune identifiée par un hash de son contenu.

Ce qui est stocké sur Docker Hub :

- **Layers** : Docker Hub stocke les différentes layers qui composent votre image. Ces layers contiennent les modifications du système de fichiers et les métadonnées.
- **Le manifeste d’image** : Un fichier JSON qui décrit l’image, y compris les couches qui la composent et d’autres métadonnées. visible via `docker inspect image_id`
- **Configuration d’image** : Contient la configuration d’exécution, comme les variables d’environnement, les ports exposés et la commande par défaut à exécuter.

Docker Hub ne fait qu’héberger votre image. Elle ne devient exécutable que lorsqu'elle est récupérée puis exécutée sur une machine avec `docker run` .

De même, Docker Hub n'exécute ni les images ni les containers, mais il peut réaliser certains processus :

- **Scan d’images** : Recherche de vulnérabilités connues.
- **Webhooks** : Déclenche des actions lors du push d'une image.
- **Builds automatisés** : Peut créer automatiquement des images à partir de repository Git.

Quand un utilisateur récupère l’image depuis Docker Hub avec la commande `docker pull skatai/ynov-docker:v1`:

- Docker télécharge les couches nécessaires et reconstruit l’image localement ce qui lui permet ensuite de pouvoir exécuter un conteneur à partir de cette image
