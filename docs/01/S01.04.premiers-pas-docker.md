# D√©cryptons le hello world

Dans ce document:

- on analyse les cons√©quences de la commande ```docker run -d -p 8080:80 docker/welcome-to-docker```
- On parle de hash strings et de fonctions hash

## Que fait ```docker run``` ?

Revenons sur la sortie dans le terminal de la commande:

```bash
docker run -d -p 8080:80 docker/welcome-to-docker
```

Ici:

- `docker/welcome-to-docker` est le nom d'une image
- `docker run` est la commande pour cr√©er et executer un container a partir de cette image
- `-d` et `-p` sont des flags de configuration

On a

```bash
> docker run -d -p 8080:80 docker/welcome-to-docker
Unable to find image 'docker/welcome-to-docker:latest' locally
latest: Pulling from docker/welcome-to-docker
96526aa774ef: Pull complete
740091335c74: Pull complete
da9c2e764c5b: Pull complete
ade17ad21ef4: Pull complete
4e6f462c8a69: Pull complete
1324d9977cd2: Pull complete
1b9b96da2c74: Pull complete
5d329b1e101a: Pull complete
Digest: sha256:eedaff45e3c78538087bdd9dc7afafac7e110061bbdd836af4104b10f10ab693
Status: Downloaded newer image for docker/welcome-to-docker:latest
e6780a6285cf019b4637ca1bd99f612911a49e6ba7e9069cec35f79793bfae23
```

- La premi√®re ligne montre que docker va essayer de r√©cup√©rer (pull) l'image ```docker/welcome-to-docker``` localement et qu'il ne la trouve pas.
- Donc il va la r√©cup√©rer a partir d'un repository en ligne (**docker hub**)
- Il r√©cup√®re ensuite pas moins de 8 √©l√©ments.
  - Les strings de type _740091335c74_ sont les **hash** li√©s aux √©l√©ments r√©cup√©r√©s. En quelque sorte des identifiants uniques
- `Status:...` Il confirme que l'image la plus r√©cente a bien √©t√© r√©cup√©r√©e.
- Et il donne 2 longs hash d'identification:
  - le premier: ```Digest: sha256:eedaff45e3c78538087...``` correspond au **manifest** de l'image (fichier JSON auto g√©n√©r√© qui d√©crit les composants de l'image).
  - le deuxi√®me est le hash d'identification du container : 'e6780a...'

Donc pas mal de chose et surtout beaucoup de hash strings!

## HASH string et fonctions de Hashing

Une fonction de hashing est un algorithme qui prends un cha√Æne de caract√®res en entr√©e (ou un contenu binaire) et qui produit une cha√Æne de caract√®re appel√©e HASH qui est de de taille d√©termin√©e.

![Hash Function](./../../img/hash-function.png)

La [fonction de hashing](https://fr.wikipedia.org/wiki/Fonction_de_hachage) (hachage en fran√ßais ü•π ) a des propri√©t√©s tr√®s sp√©cifiques:

- **D√©terministe** : la m√™me entr√©e produit toujours la m√™me sortie
- **Rapide** : le calcul du HASH est super rapide pour pouvoir √™tre appliqu√© √† des volumes importants de donn√©es.
- **Distribution uniforme** : tous les symboles sont utilis√©s avec la m√™me fr√©quence
- **Effet d'avalanche** : un petit changement dans le contenu en entr√©e change fortement le HASH en sortie.

Mais surtout :

- **unicit√©**: la probabilit√© pour que 2 textes diff√©rents aient le m√™me hash  est de 1 sur 3.4 x 10^38. On appelle √ßa le risque de collision.

Une probabilit√© de 1 sur 3.4 x 10^38 revient √† dire que si on pouvait g√©n√©rer 1 Milliard de hashes par second, on aurait 50% de chance d'avoir une collision en 10^19 ann√©es. Par comparaison l'√¢ge de l'univers est de 1.38√ó10^10!

- **transformation √† sens unique** : il est impossible de retrouver le contenu original a partir du simple hash! parfait pour stocker les mots de passe de fa√ßon s√©curis√©e

Les HASH strings sont utilis√©es dans de nombreux domaines

1. Structures de donn√©es : Tables de hachage pour une recherche, insertion et suppression de donn√©es rapides.
2. Cryptographie : Stockage des mots de passe : Stocker les mots de passe de mani√®re s√©curis√©e en les hachant.
3. Int√©grit√© des donn√©es : Sommes de contr√¥le : D√©tecter les modifications accidentelles des donn√©es lors de la transmission ou du stockage.
4. Mise en cache : Utiliser des hachages comme cl√©s pour stocker et r√©cup√©rer des donn√©es en cache.
5. Technologie blockchain : Preuve de travail : Fondamentale pour de nombreux algorithmes de minage de cryptomonnaies.

et Git!

### Fonctions de hash

Il existent de multiples fonctions Hash qui diff√®rent par leur qualit√©: SHA256, MD5, ...

| Nom       | Output Size (bits) | Speed           | Security     | Common Use Cases                      |
|------------|:------------------:|-----------------|--------------|---------------------------------------|
| MD5        | 128                | Very Fast       | Broken       | Checksums (non-security)              |
| SHA-1      | 160                | Fast            | Weak         | Legacy systems, Git                   |
| SHA-256    | 256                | Moderate        | Strong       | Digital signatures, blockchain        |
| SHA-3      | 224-512            | Slow            | Very Strong  | High-security applications            |
| BLAKE2     | 256/512            | Very Fast       | Strong       | Fast hashing needs                    |
| bcrypt     | 184                | Very Slow       | Strong       | Password hashing                      |
| Argon2     | Variable           | Configurable    | Very Strong  | Password hashing, key derivation      |
| CRC32      | 32                 | Extremely Fast  | Not Secure   | Error detection                       |
| MurmurHash | 32/128             | Extremely Fast  | Not Secure   | Hash tables, caches                   |

Donc en r√©sum√©

- Le **hash string** est un **identifiant universellement unique** d'un contenu, fichier, texte etc...
- Il est impossible de retrouver le contenu original √† partir de son HASH string

## De retour √† Docker

La commande

```bash
docker run -d -p 8080:80 docker/welcome-to-docker
```

se d√©compose de la fa√ßon suivante:

- ```docker run``` : executer une image ou un container
- ```-d``` : mode d√©tach√© (le terminal redevient disponible apr√®s )
- ```-p 8080:80``` :  un mapping de port: celui interne au container: 80  qui est ainsi li√© au port externe 8080. C'est sur ce port **8080** qu'on acc√®de au service offert par l'image via l'url ```http://localhost:**8080**```
- Le nom de l'image ```docker/welcome-to-docker```

Notez que docker essaie de trouver non pas ```docker/welcome-to-docker``` mais ```docker/welcome-to-docker:latest```. **latest** est un tag de version. Par d√©faut pour un nom d'image donn√©, si on ne sp√©cifie pas le tag de version docker va chercher la version la plus r√©cente qui est tagu√©e par le mot **latest**.

- `docker run ubuntu` ~= `docker run ubuntu:latest``
- `docker run ubuntu:22.04`

## CLI

On peut lister les containers et les images disponible sur l'ordi, en ligne de commande (CLI: command line interface) avec

### ```docker images```

```bash
> docker images
REPOSITORY                 TAG       IMAGE ID       CREATED         SIZE
docker/welcome-to-docker   latest    c1f619b6477e   10 months ago   18.6MB
```

on retrouve:

- le nom de l'image: `docker/welcome-to-docker`
- le tag: `latest`
- l'image ID. Ici le hash correspond au fichier executable int√©grale de l'image (pas son manifeste)
- la date de cr√©ation de l'image
- sa taille

Donc √† retenir: ```docker images``` pour lister les images

### docker ps

La commande pour lister les containers est : ```docker ps```. (```ps``` veut dire ```process status```)

```bash
> docker ps
CONTAINER ID   IMAGE                      COMMAND                  CREATED
e6780a6285cf   docker/welcome-to-docker   "/docker-entrypoint.‚Ä¶"   ...

    PORTS                  NAMES
    0.0.0.0:8080->80/tcp   hungry_snyder
```

- ici le hash _e6780a6285cf_ tient lieu d'ID du container. C'est une version abr√©g√©e du hash string de la derni√®re ligne de ```docker run```: _e6780a6285cf019b4637ca1bd99f612911a49e6ba7e9069cec35f79793bfae23_
- un extrait de la ligne de commande qui a √©t√© execut√© une fois le container lanc√©. C'est ce qui a parmit d'acceder a une page sur localhost
- On trouve aussi le mapping entre les ports: externe -> interne : ```0.0.0.0:8080->80/tcp```
- enfin un nom al√©atoire qui a √©t√© assign√© au container par docker. ```hungry_snyder```

Donc √† retenir: ```docker ps``` pour lister les containers (qui sont en cours d'√©x√©cution).

Pour lister tout les containers meme ceux arr√™t√©s, on ajoute `-all`

```bash
docker ps -a
```

## et Docker Desktop dans tout √ßa ?

La ligne de commande, c'est super mais on a aussi **Docker Desktop**

On y retrouve bien les informations donn√©es par ```docker images```

![](./../../img/docker-desktop-images.png)

et les √©l√©ments donn√©es par ```docker ps``` pour le container.

![](./../../img/docker-desktop-containers.png)

Il y a une correspondance directe entre l'appli Docker Desktop et docker en ligne de commande.

Dans la suite on utilisera la ligne de commande le plus possible mais docker desktop est utile pour avoir une vue d'ensemble.

## Conclusion

A ce stade vous devriez:

- comprendre que docker va changer votre vie
- avoir install√© Docker Desktop, WSL2
- avoir ex√©cut√© le container  `hello world` √† partir de l'image ... hello world
- savoir lister et g√©rer les containers (ps, start, stop) ainsi que les images en ligne de commande
- retrouver les information d'un container ou d'une image dans Docker Desktop
- comprendre la diff√©rence entre image et containers

Dans la prochaine session, nous attaquons Linux et nous cr√©ons une premiere image pour faire tourner un serveur web.
